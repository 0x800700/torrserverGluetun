# TorrServer — настройка HTTP Basic Authentication (accs.db)

Данная инструкция описывает, как **включить и изменить HTTP Basic Authentication** в TorrServer
с помощью файла `accs.db`, согласно официальной документации YouROK/TorrServer.

Источник: https://github.com/YouROK/TorrServer (раздел **Authentication**)

---

## 1. Что такое accs.db

`accs.db` — это файл с учетными данными пользователей TorrServer для **HTTP Basic Auth**.

- Формат: **JSON**
- Тип авторизации: **Basic Access Authentication**
- Используется **только** при запуске TorrServer с параметром `--httpauth`

---

## 2. Где находится файл accs.db

В Docker-установке TorrServer файл расположен в каталоге данных (`--path`).

В нашем случае структура проекта выглядит так:

```
project-root/
└── opt/
    └── torrserver/
        └── db/
            └── accs.db
```

Полный путь к файлу:

```
./opt/torrserver/db/accs.db
```

---

## 3. Формат файла accs.db

Файл представляет собой **JSON-объект**, где:

- ключ — имя пользователя
- значение — пароль

### Пример с двумя пользователями

```json
{
  "User1": "Pass1",
  "User2": "Pass2"
}
```

⚠️ Важно:
- Файл **не должен** быть массивом
- Запятые обязательны
- Кавычки — только двойные (`"`)

---

## 4. Редактирование accs.db

### 4.1 Перейти в каталог проекта

```bash
cd /путь/к/проекту
```

### 4.2 Открыть файл в nano

```bash
nano ./opt/torrserver/db/accs.db
```

### 4.3 Отредактировать файл

Пример содержимого:

```json
{
  "user1": "Pass1",
  "admin": "StrongPassword123"
}
```

### 4.4 Сохранить файл

1. Нажать **Ctrl + X**
2. Нажать **Y** (подтвердить сохранение)
3. Нажать **Enter**

---

## 5. Перезапуск TorrServer

После изменения `accs.db` необходимо перезапустить контейнер TorrServer.

### Если используется Docker Compose

```bash
docker compose restart torrserver
```

или (для старых версий Docker):

```bash
docker-compose restart torrserver
```

---

## 6. Проверка работы авторизации

### 6.1 В браузере

Открыть:

```
http://IP_СЕРВЕРА:8090
```

Браузер запросит логин и пароль — используйте данные из `accs.db`.

---

### 6.2 Через curl

```bash
curl -u user1:Pass1 http://127.0.0.1:8090/echo
```

Ожидаемый ответ:

```
MatriX.137
```

---

### 6.3 В Lampa

В настройках TorrServer указать:

- Адрес: `http://IP_СЕРВЕРА:8090`
- Логин: `user1`
- Пароль: `Pass1`

---

## 7. Частые ошибки

### ❌ TorrServer пускает без пароля

Проверьте, что TorrServer запущен **с параметром**:

```
--httpauth
```

---

### ❌ Логин/пароль не принимаются

- Проверьте формат JSON
- Убедитесь, что файл называется именно `accs.db`
- Проверьте путь `--path`
- Перезапустите контейнер после изменений

---

## 8. Примечания по безопасности

- Пароли хранятся **в открытом виде**
- Рекомендуется:
  - ограничить доступ к порту 8090 (Firewall / MikroTik)
  - использовать VPN (gluetun)
  - не публиковать TorrServer напрямую в интернет

---

## 9. Резюме

1. Создать/отредактировать `accs.db`
2. Запустить TorrServer с `--httpauth`
3. Перезапустить контейнер
4. Подключаться с логином и паролем

Готово ✅
